{
    "collab_server" : "",
    "contents" : "library(dplyr)\n\nallzips <- readRDS(\"data/superzip.rds\")\nallzips$latitude <- jitter(allzips$latitude)\nallzips$longitude <- jitter(allzips$longitude)\nallzips$college <- allzips$college * 100\nallzips$zipcode <- formatC(allzips$zipcode, width=5, format=\"d\", flag=\"0\")\nrow.names(allzips) <- allzips$zipcode\n\ncleantable <- allzips %>%\n  select(\n    City = city.x,\n    State = state.x,\n    Zipcode = zipcode,\n    Rank = rank,\n    Score = centile,\n    Superzip = superzip,\n    Population = adultpop,\n    College = college,\n    Income = income,\n    Lat = latitude,\n    Long = longitude\n  )\n\n\nhomi.r <- read.csv(\"data/database.csv\")\nsuppressMessages(attach(homi.r))\noptions(warn=-1)\n# head(homi.r)\n#cityincident <- homi.r %>% \n#  ungroup() %>%\n # select(City,Incident)\n#cityincident <- aggregate(cityincident$Incident, by=list(City=cityincident$City), FUN=sum)\n\nwarn.conflicts = FALSE\n\nsuppressMessages(library(tidyr))\nsuppressMessages(library(stringr))\nsuppressMessages(library(stringi))\nsuppressMessages(library(forcats))\nsuppressMessages(library(ggplot2))\nsuppressMessages(library(gridExtra))\nsuppressMessages(library(Hmisc))\n\nstr(homi.r)\ndim(homi.r)\nanyDuplicated(homi.r$Record.ID)\nnames(homi.r)\nnames(homi.r) <- tolower(names(homi.r))\n\nnames(homi.r)\nsapply(homi.r[1,],class)\nlength(homi.r$crime.solved[homi.r$crime.solved == \"Yes\"])\nhomi.r$victim.age[homi.r$victim.age==998]<-98\n\nhomi.r$perpetrator.age[is.na(homi.r$perpetrator.age)]<- 1\nlevels(homi.r$crime.solved)\n\n\n##############\n\nhomi.r.solved <- homi.r %>% filter(\n  crime.solved    == \"Yes\" &\n    victim.sex      != \"Unknown\" &\n    perpetrator.sex != \"Unknown\" &\n    relationship    != \"Unknown\"\n)%>%\n  droplevels()\n\n\nhomi.r.solved$victim.age[homi.r.solved$victim.age==998]<-98\n\nhomi.r.solved$perpetrator.age[is.na(homi.r.solved$perpetrator.age)]<- 1\n\n\ngirl.boy.crime<-homi.r.solved %>% filter(\n  relationship    %in% c(\"Girlfriend\",\"Boyfriend\") &\n    victim.age      >= 18 &\n    perpetrator.age >= 18 &\n    victim.sex      != \"Unknown\" &\n    perpetrator.sex != \"Unknown\"\n) %>%\n  droplevels() %>%\n  select(record.id, agency.type,city,state,year,month,crime.type,\n         crime.solved,victim.sex,victim.age,victim.race,victim.ethnicity,perpetrator.sex,\n         perpetrator.age,perpetrator.race,perpetrator.ethnicity,relationship,weapon,record.source)\n\n# table(girl.boy.crime$victim.sex)\n# Female   Male \n#   7468   3619\n# table(girl.boy.crime$perpetrator.sex)\n# Female   Male \n#   3460   7627\n\n# something wrong !!!\n\ngirl.boy.crime<-girl.boy.crime[!(girl.boy.crime$victim.sex==girl.boy.crime$perpetrator.sex),]\n\n# table(girl.boy.crime$victim.sex)\n# Female   Male \n# 7434   3426 \n# table(girl.boy.crime$perpetrator.sex)\n# Female   Male \n# 3426   7434 \n\n# now it is OK \n\n############################################\n\n# Who killed Who (Familicide). Unfortunately !\n\n\nhomi.r.solved$who.killed.who <- ifelse(homi.r.solved$relationship==\"Brother\" &\n                                         homi.r.solved$perpetrator.sex ==\"Male\" ,\n                                       \"Brother Killed by Brother\",\n                                       ifelse(homi.r.solved$relationship==\"Brother\" &\n                                                homi.r.solved$perpetrator.sex ==\"Female\" ,\n                                              \"Brother Killed by Sister\",\n                                              ifelse(homi.r.solved$relationship==\"Sister\" &\n                                                       homi.r.solved$perpetrator.sex ==\"Female\" ,\n                                                     \"Sister Killed by Sister\",\n                                                     ifelse(homi.r.solved$relationship==\"Sister\" &\n                                                              homi.r.solved$perpetrator.sex ==\"Male\" ,\n                                                            \"Sister Killed by Brother\",\n                                                            ifelse(homi.r.solved$relationship==\"Father\" &\n                                                                     homi.r.solved$perpetrator.sex ==\"Female\" ,\n                                                                   \"Father Killed by Daughter\",\n                                                                   ifelse(homi.r.solved$relationship==\"Father\" &\n                                                                            homi.r.solved$perpetrator.sex ==\"Male\" ,\n                                                                          \"Father Killed by Son\",\n                                                                          ifelse(homi.r.solved$relationship==\"Mother\" &\n                                                                                   homi.r.solved$perpetrator.sex ==\"Male\" ,\n                                                                                 \"Mother Killed by Son\",\n                                                                                 ifelse(homi.r.solved$relationship==\"Mother\" &\n                                                                                          homi.r.solved$perpetrator.sex ==\"Female\" ,\n                                                                                        \"Mother Killed by Daughter\",\n                                                                                        ifelse(homi.r.solved$relationship==\"Wife\" &\n                                                                                                 homi.r.solved$perpetrator.sex ==\"Male\" ,\n                                                                                               \"Wife Killed by Husband\",\n                                                                                               ifelse(homi.r.solved$relationship==\"Husband\" &\n                                                                                                        homi.r.solved$perpetrator.sex ==\"Female\" ,\n                                                                                                      \"Husband Killed by Wife\",\n                                                                                                      ifelse(homi.r.solved$relationship==\"Son\" &\n                                                                                                               homi.r.solved$perpetrator.sex ==\"Female\" ,\n                                                                                                             \"Son Killed by Mother\",\n                                                                                                             ifelse(homi.r.solved$relationship==\"Son\" &\n                                                                                                                      homi.r.solved$perpetrator.sex ==\"Male\" ,\n                                                                                                                    \"Son Killed by Father\",\"UKN\"\n                                                                                                             ))))))))))))\n# Im sure there is a simpler way to do the same, but really i do not have Time ..!\n\nex.husband.ex.wife.crime<-homi.r.solved %>% filter(\n  relationship     %in% c(\"Ex-Husband\",\"Ex-Wife\") &\n    victim.age       >= 18 &\n    perpetrator.age  >= 18 &\n    victim.sex      != \"Unknown\" &\n    perpetrator.sex != \"Unknown\"\n) %>%\n  droplevels() %>%\n  select(record.id, agency.type,city,state,year,month,crime.type,\n         crime.solved,victim.sex,victim.age,perpetrator.sex,\n         perpetrator.age,relationship,weapon)\n\n# there are Female in both features victim .sex and perpetrator.sex ..and Male as well which is wrong..!\n# so I consider that the victim sex to be my reference because it is the subject of this dataset.\nex.husband.ex.wife.crime$relationship <- ifelse(ex.husband.ex.wife.crime$victim.sex==\"Male\",\n                                                \"Ex-Husband\",\"Ex-Wife\")\n# I think there was some typo here \n\n# OK let's move on\n\nex.husband.ex.wife.crime$older.or.younger <- ifelse(ex.husband.ex.wife.crime$relationship==\"Ex-Husband\" &\n                                                      ex.husband.ex.wife.crime$perpetrator.age < ex.husband.ex.wife.crime$victim.age,\n                                                    \"Ex-wife Killed an old Ex-Husband\",\n                                                    ifelse(ex.husband.ex.wife.crime$relationship==\"Ex-Husband\" &\n                                                             ex.husband.ex.wife.crime$perpetrator.age > ex.husband.ex.wife.crime$victim.age,\n                                                           \"Ex-wife Killed a young Ex-Husband\",\n                                                           ifelse(ex.husband.ex.wife.crime$relationship==\"Ex-Wife\" &\n                                                                    ex.husband.ex.wife.crime$perpetrator.age > ex.husband.ex.wife.crime$victim.age,\n                                                                  \"Ex- Husband Killed a young Ex-Wife\",\n                                                                  ifelse(ex.husband.ex.wife.crime$relationship==\"Ex-Wife\" &\n                                                                           ex.husband.ex.wife.crime$perpetrator.age < ex.husband.ex.wife.crime$victim.age,\n                                                                         \"Ex-Husband Killed an old Ex-Wife\",\"Smae Age\"))))\nndf.by.weapon <- homi.r.solved %>% filter(\n  weapon != \"Unknown\" &\n    victim.sex != \"Unknown\"&\n    perpetrator.sex != \"Unknown\" &\n    victim.age       >= 18 &\n    perpetrator.age  >= 18\n) %>% \n  droplevels()%>%\n  select(record.id, agency.type,city,state,year,month,crime.type,\n         crime.solved,victim.sex,victim.age,perpetrator.sex,\n         perpetrator.age,relationship,weapon)\n\nhomi.r.solved$who.killed.who.sex <- ifelse(homi.r.solved$perpetrator.sex==\"Female\"& homi.r.solved$victim.sex==\"Male\",\n                                           \"Male Killed by Female\",\n                                           ifelse(homi.r.solved$perpetrator.sex==\"Male\"& homi.r.solved$victim.sex==\"Female\",\n                                                  \"Female Killed by Male\",\n                                                  ifelse(homi.r.solved$perpetrator.sex ==\"Male\" & homi.r.solved$victim.sex == \"Male\",\n                                                         \"Male Killed by Male\",\n                                                         ifelse(homi.r.solved$perpetrator.sex ==\"Female\" & homi.r.solved$victim.sex == \"Female\",\n                                                                \"Female Killed by Female\", \"UNK\"))))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nemployee.employer.crime<-homi.r.solved %>% filter(\n  relationship     %in% c(\"Employee\",\"Employer\") &\n    victim.age       >= 18 &\n    perpetrator.age  >= 18 &\n    victim.sex      != \"Unknown\" &\n    perpetrator.sex != \"Unknown\"\n) %>%\n  droplevels() %>%\n  select(record.id, agency.type,city,state,year,month,crime.type,\n         crime.solved,victim.sex,victim.age,perpetrator.sex,\n         perpetrator.age,relationship,weapon,who.killed.who.sex)\nfriend.crime<-homi.r.solved %>% filter(\n  relationship       == \"Friend\" &\n    victim.sex      != \"Unknown\" &\n    victim.age       >= 18 &\n    perpetrator.age  >= 18 &\n    perpetrator.sex != \"Unknown\"\n) %>%\n  droplevels() %>%\n  select(record.id, agency.type,city,state,year,month,crime.type,\n         crime.solved,victim.sex,victim.age,perpetrator.sex,\n         perpetrator.age,relationship,weapon)\n\nfriend.crime$who.killed.who.Friend.sex <- ifelse(friend.crime$perpetrator.sex == \"Female\" & friend.crime$victim.sex == \"Male\",\n                                                 \"Friends Male Killed by Female\",\n                                                 ifelse(friend.crime$perpetrator.sex == \"Male\"& friend.crime$victim.sex == \"Female\",\n                                                        \"Friends Female Killed by Male\",\n                                                        ifelse(friend.crime$perpetrator.sex == \"Male\" & friend.crime$victim.sex == \"Male\",\n                                                               \"Friends Male Killed by Male\",\n                                                               ifelse(friend.crime$perpetrator.sex == \"Female\" & friend.crime$victim.sex == \"Female\",\n                                                                      \"Friends Female Killed by Female\", \"UNK\"))))\n\n\nby.race <-homi.r.solved %>% filter(\n  victim.age       >= 18 &\n    perpetrator.age  >= 18 &\n    victim.race      != \"Unknown\" &\n    perpetrator.race != \"Unknown\"\n) %>%\n  droplevels() %>%\n  select(record.id, agency.type,city,state,year,month,crime.type,\n         crime.solved,victim.sex,victim.race,perpetrator.race,victim.age,perpetrator.sex,\n         perpetrator.age,relationship,weapon)\n\n\nby.weapon <- dplyr::summarise(group_by(ndf.by.weapon,weapon),freq.by.weapon =n())%>%\n  arrange(desc(freq.by.weapon))\n\nby.weapon.sex <- dplyr::summarise(group_by(ndf.by.weapon,weapon,victim.sex),freq.by.weapon =n())%>%\n  arrange(desc(freq.by.weapon))\n\nndf.by.weapon$sex.weapon.used <- sprintf(\"%s Killed by %s Using a %s\",\n                                         ndf.by.weapon$victim.sex,\n                                         ndf.by.weapon$perpetrator.sex,\n                                         ndf.by.weapon$weapon)\n\n\nby.ndf.by.weapon.used <- dplyr::summarise(group_by(ndf.by.weapon,sex.weapon.used),\n                                   freq.by.weapon.used =n())%>%\n  arrange(desc(freq.by.weapon.used))\n\n\nndf.by.weapon.geom.points <-ndf.by.weapon %>% filter(\n  sex.weapon.used   %in% c(\"Male Killed by Male Using a Handgun\",\n                           \"Male Killed by Male Using a Knife\",\n                           \"Female Killed by Male Using a Handgun\",\n                           \"Male Killed by Male Using a Blunt Object\",\n                           \"Female Killed by Male Using a Knife\")\n) %>%\n  droplevels() %>%\n  select(record.id, agency.type,city,state,year,month,crime.type,\n         crime.solved,victim.sex,victim.age,perpetrator.sex,\n         perpetrator.age,relationship,weapon,sex.weapon.used) \n\nhomi.r.solved.age <- homi.r.solved %>% filter(\n  victim.age       >= 18 &\n    perpetrator.age  >= 18 &\n    victim.race      != \"Unknown\" &\n    perpetrator.race != \"Unknown\"\n) %>%\n  droplevels()\n\n\n\nhomi.r.solved.age$vic.age.group <- cut(homi.r.solved.age$victim.age, \n                                       breaks = c(18, 30, 40, 50,60, 70, 80, 90, 100), \n                                       labels = c(\"18-30 yrs\", \"30-40 yrs\",\n                                                  \"40-50 yrs\", \"50-60 yrs\",\"60-70 yrs\",\"70-80 yrs\",\n                                                  \"80-90 yrs\",\"90-100 yrs\"),\n                                       right = FALSE)\n\nhomi.r.solved.age$per.age.group <- cut(homi.r.solved.age$perpetrator.age, \n                                       breaks = c(18, 30, 40, 50,60, 70, 80, 90, 100), \n                                       labels = c(\"18-30 yrs\", \"30-40 yrs\",\n                                                  \"40-50 yrs\", \"50-60 yrs\",\"60-70 yrs\",\"70-80 yrs\",\n                                                  \"80-90 yrs\",\"90-100 yrs\"),\n                                       right = FALSE)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nby.year <- dplyr::summarise(group_by(homi.r.solved,year),freq.year =n())%>%\n  arrange(desc(freq.year)) \n\nby.month <- dplyr::summarise(group_by(homi.r.solved,month),freq.month =n())%>%\n  arrange(desc(freq.month))\n\n\nby.family <- dplyr::summarise(group_by(homi.r.solved[homi.r.solved$who.killed.who!=\"UKN\", ],who.killed.who),total.number.re =n())%>%\n  arrange(desc(total.number.re))\n\nby.state <- dplyr::summarise(group_by(homi.r.solved,state),freq.by.state =n())%>%\n  arrange(desc(freq.by.state))\n\n\nby.weapon <- dplyr::summarise(group_by(ndf.by.weapon,weapon),freq.by.weapon =n())%>%\n  arrange(desc(freq.by.weapon))\n\nby.weapon.sex <- dplyr::summarise(group_by(ndf.by.weapon,weapon,victim.sex),freq.by.weapon =n())%>%\n  arrange(desc(freq.by.weapon))\n\nndf.by.weapon$sex.weapon.used <- sprintf(\"%s Killed by %s Using a %s\",\n                                         ndf.by.weapon$victim.sex,\n                                         ndf.by.weapon$perpetrator.sex,\n                                         ndf.by.weapon$weapon)\n\n\nby.ndf.by.weapon.used <- dplyr::summarise(group_by(ndf.by.weapon,sex.weapon.used),\n                                   freq.by.weapon.used =n())%>%\n  arrange(desc(freq.by.weapon.used))\nempyr.empee.sex <- employee.employer.crime %>%\n  group_by(victim.sex, \n           perpetrator.sex,\n           who.killed.who.sex,\n           relationship) %>%\n  dplyr::summarise(sex.freq = n()) %>%\n  arrange(victim.sex, perpetrator.sex)\n\nby.p.race.group <- dplyr::summarise(group_by(by.race,perpetrator.race,victim.race),total.by.race = n()) %>%\n  arrange(total.by.race)\n\n\nby.p.race.group$who.killed.who.race <- sprintf(\"%s Killed by %s\",\n                                               by.p.race.group$victim.race,\n                                               by.p.race.group$perpetrator.race)\n\nby.p.race.group$freq <- round(by.p.race.group$total.by.race/sum(by.p.race.group$total.by.race)*100,2)\n\n\nby.p.race.group$freq<- paste(by.p.race.group$freq,\"%\",sep=\"\")\n\n\ntop4.by.race <- by.p.race.group[16:13,c(4,3,5)]\n\n\ntable.by.race <- tableGrob(top4.by.race[ ,c(1,3)], rows=NULL)\n\nby.v.age.group <- dplyr::summarise(group_by(homi.r.solved.age,vic.age.group),total.by.group.v = n()) %>%\n  arrange(total.by.group.v)\n\nby.p.age.group <- dplyr::summarise(group_by(homi.r.solved.age,per.age.group),total.by.group.p = n()) %>%\n  arrange(total.by.group.p)\n\n\nby.v.p.age.group <- dplyr::summarise(group_by(homi.r.solved.age,vic.age.group,per.age.group,perpetrator.sex,\n                                       victim.sex),\n                              total.by.group.vp = n()) %>%\n  arrange(total.by.group.vp)\n\n\n\n\n#################################################\nhomi.theme<-theme(\n  axis.text = element_text(size = 8),\n  axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0.5),\n  axis.title = element_text(size = 14),\n  panel.grid.major = element_line(color = \"grey\"),\n  panel.grid.minor = element_blank(),\n  panel.background = element_rect(fill = \"snow1\"),\n  legend.position = \"right\",\n  legend.justification = \"top\", \n  legend.background = element_blank(),\n  panel.border = element_rect(color = \"black\", fill = NA, size = 1))\n####################################################\n\ntt.homi.f <- ttheme_minimal(\n  core=list(bg_params = list(fill = \"azure\", col=\"darkblue\"),\n            fg_params=list(fontface=6)),\n  colhead=list(fg_params=list(col=\"navyblue\", fontface=4L)))\n\n\n\n\nggplot(by.v.p.age.group,aes(x = per.age.group, vic.age.group,y = total.by.group.vp))+\n  geom_bar(stat = \"identity\",fill=\"steelblue\",width=0.5)+\n  facet_wrap(~ vic.age.group)+\n  homi.theme+\n  theme(axis.text.x=element_text(size= 7, \n                                 angle=90,hjust = 0.5),\n        axis.title.y=element_text(size=10),\n        axis.title.x=element_text(size=10))+\n  theme(plot.title = element_text(size = 10))+\n  theme(strip.text = element_text(size=10,color =\"darkblue\"))+\n  ggtitle(\"Age Group 18+ \\n Victim VS perpedator\")+\n  labs(x=\"Perpedator\",\n       y=\"Number of Incidents\")",
    "created" : 1494630913260.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "721588443",
    "id" : "185544",
    "lastKnownWriteTime" : 1494533722,
    "last_content_update" : 1494533722,
    "path" : "C:/Users/pandy/Desktop/063-superzip-example/global.R",
    "project_path" : "global.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}